---
title: "ggplot2 Notes"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error = TRUE)
```

```{r initials, message=FALSE}

library(ggplot2)

chic <- readr::read_csv("https://raw.githubusercontent.com/z3tt/ggplot-courses/main/data/chicago-nmmaps-custom.csv")

```


```{r}

knitr::kable(head(chic))  
```


## Working with Axes, Titles, Legends and themeing etc.

### `paste` or `paste0` doesn't work as intended inside the `expression()`

`paste0` doesn't inside the `expression`. But `paste` works (sort of) and we have to give extra space inside the `paste` to separate the words. This happens both for `ggplot2` and `base-plot`. Asked a question about this behaviour in [SO](https://stackoverflow.com/questions/73045568/why-paste0-is-not-working-properly-inside-expression-in-either-ggplot2-or-ba).

```{r}
g <- ggplot(chic, aes(date, temp))

g + geom_point(color = "firebrick") +
  labs(x = "Year", y = expression( paste("Temperature (", degree ~ F, ")")))


```

##### For ggplot2

```{r}
library(ggplot2)

ggplot(mtcars, aes(mpg, disp)) +
  geom_point() +
  labs(
    x = expression(paste0("It's","mpg")^("paste0 is not working")),
    y = expression(paste("It's ", "disp")^("paste is working")),
  )
```

##### For base-plot

```{r}
plot(mtcars$disp ~ mtcars$mpg, 
     xlab = expression(paste0("mpg")^("paste0 is not working")),
     ylab = expression(paste("disp")^("paste is working"))
     )
```

So the reason for happening such, because inside `expression` only some defined syntax are allowed, which we can find at the help page of `plotmath` (using `?plotmath`)

## `vjust` moves text vertically from the perspective of the Axes

which means when you use `vjust` in `axis.title.y = element_text()`, to move the y-axis title, it will move horizontally (from Our perspective), but this horizontal movement is vertical from the perspective of y-axis.

```{r}
ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = "firebrick") +
  labs(x = "Year", y = "Temperature (°F)") +
  theme(axis.title.x = element_text(vjust = 0, size = 15),
        axis.title.y = element_text(vjust = 2, size = 15))
  
```

## Changes in `margin(t, r, b, l)` are from our perspective.

That is, if we want to change the distance between y-axis title and y-axis, we need to increase the **right-margin** of `axis.title.y`, not the bottom the margin (unlike how `vjust` works)

```{r}
ggplot(chic, aes(x = date, y = temp)) +
  geom_point(color = "firebrick") +
  labs(x = "Year", y = "Temperature (°F)") +
  theme(axis.title.x = element_text(margin = margin(t = 10), size = 15),
        axis.title.y = element_text(margin = margin(r = 10), size = 15))
```

## `coord_cartesian(ylim = c(0, 50)) `and `ylim(c(0, 50))` are not the same

`ylim(c, 50)` (similarly `scale_y_continous(limits = c(0, 50)`) simply filters or subset the given data based on the y value being in the range(0, 50) and does plotting based on this filtered data.

While `coord_cartesian(ylim = c(0, 50))` plots based on the whole dataset but then zoom into such a way that y-axis be from 0 to 50.

To get this distinction,

#### `scale_y_continuous(limits = c(0, 50)) `or `ylim(c(0, 50))`

```{r}
ggplot(chic, aes(factor(year), temp, group = year)) +
  geom_boxplot() +
  ylim(c(0, 50))
```

#### `coord_cartesian(ylim = c(0, 50))`

```{r}
ggplot(chic, aes(factor(year), temp, group = year)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 50))
```


## Forcing a plot to start at origin

```{r}
chic_high <- dplyr::filter(chic, temp > 25, o3 > 20)

p <- ggplot(chic_high, aes(temp, o3)) + 
  geom_point(color = "darkcyan")

p
```

we need to use `expand_limits(x = 0, y = 0)` or `coord_cartesian(xlim = c(0, NA), ylim = c(0, NA))` to force plot start from `(0, 0)`

```{r}
p + expand_limits(x = 0, y = 0)
```

But if we look very carefully, we will see that there's some offset at left side of y axis at zero and at bottom side of x axis at zero. To force the plot starting exactly from zero, we can specify `expand = FALSE`, `clip = "off"` in `coord_*` function family.

```{r}
p + expand_limits(x = 0, y = 0) + 
  coord_cartesian(expand = FALSE)
```

from the help of `coord_cartesian`

> expand	If TRUE, the default, adds a small expansion factor to the limits to ensure that data and axes don't overlap. If FALSE, limits are taken exactly from the data or xlim/ylim

> clip = "off" allows drawing of data points anywhere on the plot, including in the plot margins. If limits are set via xlim and ylim and some data points fall outside those limits, then those data points may show up in places such as the axes, the legend, the plot title, or the plot margins.

So a useful use-case of `clip = "off"` is that, we can use it to draw outside the plot panel. An example from [`this twitter thread by Claus Wilke`](https://twitter.com/clauswilke/status/991542952802619392?lang=en)

```{r}

mt_named <- data.frame(mtcars, name = row.names(mtcars))

p <- ggplot(mt_named, aes(mpg, reorder(name, mpg))) +
  geom_point(size = 2.5, color = "darkcyan") +
  geom_text(aes(x = mpg + 0.5, label = name), hjust = 0, size = 3) +
  scale_x_continuous(limits = c(10, 35)) +
  theme_bw() +
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    axis.line.x = element_line(),
    plot.margin = margin(6, 45, 6, 6) # trouble
  )

p
```

**A side Note**

- `expand = c(0, 1)` in `scale_y_discrete` creates a padding around the y-axis.

> expand	=> For position scales, a vector of range expansion constants used to add some padding around the data to ensure that they are placed some distance away from the axes. Use the convenience function expansion() to generate the values for the expand argument. The defaults are to expand the scale by 5% on each side for continuous variables, and by 0.6 units on each side for discrete variables.


```{r warning=FALSE, message=FALSE}
p + scale_y_discrete(name = NULL, breaks = NULL, expand = c(0, 5))
```

Any way back to our topic of `clip`

```{r}
p + 
  scale_y_discrete(name = NULL, breaks = NULL, expand = c(0, 1)) 
```

We see that, top-left label Toyota Corolla is not showing, i.e. got cut by the plot panel, to allow that label to show, 

```{r}
p + 
  scale_y_discrete(name = NULL, breaks = NULL, expand = c(0, 1)) +
  coord_cartesian(clip = "off") 
```

